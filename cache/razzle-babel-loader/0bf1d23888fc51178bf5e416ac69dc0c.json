{"ast":null,"code":"var __jsx = React.createElement;\nimport express from 'express';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport { StaticRouter } from 'react-router-dom';\nimport App from '../browser/App';\nconst {\n  DOMAIN\n} = process.env;\nconst env = {\n  domain: DOMAIN || 'localhost'\n};\n\nconst createReactMarkup = (context, url) => renderToString(__jsx(StaticRouter, {\n  context: context,\n  location: url\n}, __jsx(App, null)));\n\nconst createHTML = (markup, assets) => `<!doctype html>\n  <html lang=\"\">\n  <head>\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n      <meta charSet='utf-8' />\n      <title>Razzle TypeScript</title>\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n      ${assets.client.css ? `<link rel=\"stylesheet\" href=\"${assets.client.css}\">` : ''}\n        ${true ? `<script src=\"${assets.client.js}\" defer></script>` : `<script src=\"${assets.client.js}\" defer crossorigin></script>`}\n  </head>\n  <body>\n      <div id=\"root\">${markup}</div>\n      <script>\n      window.env=${JSON.stringify(env)}\n    </script>\n      \n  </body>\n \n</html>`;\n\nexport default (server => {\n  let assets;\n\n  const syncLoadAssets = () => {\n    assets = require(process.env.RAZZLE_ASSETS_MANIFEST);\n  };\n\n  syncLoadAssets();\n\n  const serveIndex = (req, res) => {\n    const context = {};\n    const markup = createReactMarkup(context, req.url);\n    const page = createHTML(markup, assets);\n    res.send(page);\n  };\n\n  server.use('/static', express.static('build/public/static'));\n  server.get('/*', serveIndex);\n  server.disable('x-powered-by');\n});","map":{"version":3,"sources":["/home/bon/Documents/projects/spike/material-razzle/src/server/razzle.tsx"],"names":["express","React","renderToString","StaticRouter","App","DOMAIN","process","env","domain","createReactMarkup","context","url","createHTML","markup","assets","client","css","js","JSON","stringify","server","syncLoadAssets","require","RAZZLE_ASSETS_MANIFEST","serveIndex","req","res","page","send","use","static","get","disable"],"mappings":";AAAA,OAAOA,OAAP,MAAoD,SAApD;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,YAAT,QAA6B,kBAA7B;AAEA,OAAOC,GAAP,MAAgB,gBAAhB;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAaC,OAAO,CAACC,GAA3B;AAEA,MAAMA,GAAG,GAAG;AACVC,EAAAA,MAAM,EAAEH,MAAM,IAAI;AADR,CAAZ;;AAIA,MAAMI,iBAAiB,GAAG,CAACC,OAAD,EAAeC,GAAf,KACxBT,cAAc,CACZ,MAAC,YAAD;AAAc,EAAA,OAAO,EAAEQ,OAAvB;AAAgC,EAAA,QAAQ,EAAEC;AAA1C,GACE,MAAC,GAAD,OADF,CADY,CADhB;;AAOA,MAAMC,UAAU,GAAG,CAACC,MAAD,EAAiBC,MAAjB,KAAkC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,QACQA,MAAM,CAACC,MAAP,CAAcC,GAAd,GACK,gCAA+BF,MAAM,CAACC,MAAP,CAAcC,GAAI,IADtD,GAEI,EACL;AACP,UACU,OACK,gBAAeF,MAAM,CAACC,MAAP,CAAcE,EAAG,mBADrC,GAEK,gBAAeH,MAAM,CAACC,MAAP,CAAcE,EAAG,+BACtC;AACT;AACA;AACA,uBAAuBJ,MAAO;AAC9B;AACA,mBAAmBK,IAAI,CAACC,SAAL,CAAeZ,GAAf,CAAoB;AACvC;AACA;AACA;AACA;AACA,QA1BA;;AA4BA,gBAAgBa,MAAD,IAAqB;AAClC,MAAIN,MAAJ;;AAEA,QAAMO,cAAc,GAAG,MAAM;AAC3BP,IAAAA,MAAM,GAAGQ,OAAO,CAAChB,OAAO,CAACC,GAAR,CAAYgB,sBAAb,CAAhB;AACD,GAFD;;AAGAF,EAAAA,cAAc;;AAEd,QAAMG,UAAU,GAAG,CAACC,GAAD,EAAeC,GAAf,KAAiC;AAClD,UAAMhB,OAAO,GAAG,EAAhB;AACA,UAAMG,MAAM,GAAGJ,iBAAiB,CAACC,OAAD,EAAUe,GAAG,CAACd,GAAd,CAAhC;AACA,UAAMgB,IAAI,GAAGf,UAAU,CAACC,MAAD,EAASC,MAAT,CAAvB;AACAY,IAAAA,GAAG,CAACE,IAAJ,CAASD,IAAT;AACD,GALD;;AAOAP,EAAAA,MAAM,CAACS,GAAP,CAAW,SAAX,EAAsB7B,OAAO,CAAC8B,MAAR,CAAe,qBAAf,CAAtB;AAEAV,EAAAA,MAAM,CAACW,GAAP,CAAW,IAAX,EAAiBP,UAAjB;AAEAJ,EAAAA,MAAM,CAACY,OAAP,CAAe,cAAf;AACD,CApBD","sourcesContent":["import express, { Express, Request, Response } from 'express';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport { StaticRouter } from 'react-router-dom';\n\nimport App from '../browser/App';\n\nconst { DOMAIN } = process.env;\n\nconst env = {\n  domain: DOMAIN || 'localhost',\n};\n\nconst createReactMarkup = (context: any, url: string) =>\n  renderToString(\n    <StaticRouter context={context} location={url}>\n      <App />\n    </StaticRouter>\n  );\n\nconst createHTML = (markup: string, assets: any) => `<!doctype html>\n  <html lang=\"\">\n  <head>\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n      <meta charSet='utf-8' />\n      <title>Razzle TypeScript</title>\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n      ${\n        assets.client.css\n          ? `<link rel=\"stylesheet\" href=\"${assets.client.css}\">`\n          : ''\n      }\n        ${\n          process.env.NODE_ENV === 'production'\n            ? `<script src=\"${assets.client.js}\" defer></script>`\n            : `<script src=\"${assets.client.js}\" defer crossorigin></script>`\n        }\n  </head>\n  <body>\n      <div id=\"root\">${markup}</div>\n      <script>\n      window.env=${JSON.stringify(env)}\n    </script>\n      \n  </body>\n \n</html>`;\n\nexport default (server: Express) => {\n  let assets: any;\n\n  const syncLoadAssets = () => {\n    assets = require(process.env.RAZZLE_ASSETS_MANIFEST!);\n  };\n  syncLoadAssets();\n\n  const serveIndex = (req: Request, res: Response) => {\n    const context = {};\n    const markup = createReactMarkup(context, req.url);\n    const page = createHTML(markup, assets);\n    res.send(page);\n  };\n\n  server.use('/static', express.static('build/public/static'));\n\n  server.get('/*', serveIndex);\n\n  server.disable('x-powered-by');\n};\n"]},"metadata":{},"sourceType":"module"}